INCLUDE $TOP/test/config.htb

BLOCK:LUA _WebsocketClient
  htt.interpret("_FLUSH")
  t = htt.get_transport()
  buf = t:read(8192)

  buf = t:read(10)
  print("\nRecievied "..buf)
END

BLOCK:LUA _WebsocketServer
  t = htt.get_transport()
  t:write("1234567890")
END

CLIENT
  _REQ $YOUR_HOST $YOUR_PORT
  __GET / HTTP/1.1
  __Host: httest
  __Upgrade: websocket
  __Connection: Upgrade
  __Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
  __Origin: http://example.com
  __Sec-WebSocket-Protocol: chat, superchat
  __Sec-WebSocket-Version: 13
  __
  _WebsocketClient
END

SERVER $YOUR_PORT
  _RES
  _WAIT
  __HTTP/1.1 200 OK
  __Upgrade: websocket
  __Connection: Upgrade
  __Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
  __Sec-WebSocket-Protocol: chat
  __
  _FLUSH
  _SLEEP 100
  _WebsocketServer
END

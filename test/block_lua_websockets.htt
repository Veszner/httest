INCLUDE $TOP/test/config.htb

BLOCK:LUA WebsocketClient
  dofile("../macros/buffered.lua")

  htt.interpret("_FLUSH")
  local buffered = Buffered:new(htt.get_transport())
  for line in buffered:lines() do
    print("XXX \""..line.."\"")
    if (string.len(line) == 0) then
      break;
    end
  end
  print("Rest: \""..buffered:readblock(512).."\"")
END

CLIENT
  _REQ $YOUR_HOST $YOUR_PORT
  __GET / HTTP/1.1
  __Host: httest
  __
  WebsocketClient
END

SERVER $YOUR_PORT
_RES
_WAIT
__HTTP/1.1 200 OK
__Content-Length: AUTO
__
_-S................................................................................................................
_SLEEP 500
_-.............................................................
_SLEEP 500
_-.......................................................................................................................................
_SLEEP 500
_-............................................................
_SLEEP 500
_-..............................................................................................................................................E......................
_SLEEP 500
END

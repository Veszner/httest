INCLUDE $TOP/test/config.htb

BLOCK:LUA WebsocketClient
  dofile("../macros/buffered.lua")
  dofile("../macros/http.lua")
  htt.interpret("_FLUSH")

  local buffered = Buffered:new(htt.get_transport())
  local HTTP = HTTP:new(buffered)
  local status, headers = HTTP:readheaders()

  assert(status == "HTTP/1.1 200 OK")
  assert(headers["connection"] == "Upgrade")
  print("Rest: \""..buffered:read(512).."\"")
END

CLIENT
  _REQ $YOUR_HOST $YOUR_PORT
  __GET / HTTP/1.1
  __Websocket: Upgrade
  __Connection: Upgrade
  __Protocol: chat, superchat
  __
  WebsocketClient
END

SERVER $YOUR_PORT
_RES
_WAIT
__HTTP/1.1 200 OK
__Connection: Upgrade
__Protocol: chat
__
_-S................................................................................................................
_SLEEP 500
_-.............................................................
_SLEEP 500
_-.......................................................................................................................................
_SLEEP 500
_-............................................................
_SLEEP 500
_-..............................................................................................................................................E......................
_SLEEP 500
END

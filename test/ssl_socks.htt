# ssh key login must be configured for current user at localhost
# mac: Remote Login (=ssh/sftp) must be activated under System Preferences => Sharing

INCLUDE $TOP/test/config.htb

DAEMON
_EXEC ssh -ND localhost:${SOCKS_PORT} localhost & echo $! > /tmp/socks.pid
END

CLIENT
_SLEEP 1000
_REQ $YOUR_HOST $SOCKS_PORT 
_SOCKS:CONNECT $YOUR_HOST $YOUR_PORT
_SSL:CONNECT SSL
__GET /your/path/to/your/resource?your=params HTTP/1.1
__Host: $YOUR_HOST 
__
_WAIT

END

SERVER SSL:$YOUR_PORT
_RES
_WAIT
__HTTP/1.1 200 OK
__Content-Length: AUTO
__
__== OK ==
END

BLOCK FINALLY
_EXEC kill `cat /tmp/socks.pid`
END

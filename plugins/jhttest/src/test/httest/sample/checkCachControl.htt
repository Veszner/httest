# httest sample script to test cache control headers.
# Script do
#   - Login as admin01
#   - Get /moap3/jsf2app/browseBooks.xhtml
#   - Checks the cache control is no cache
#
# for a list of available commands run
# /share/xpository/sourceforge/httest/$VERSION/$ARCH/dist-bin/bin/httest -L
# for more explanation checkout the latest documentation found on
# http://htt.sourceforge.net/
# or ask cli@adnovum.ch

INCLUDE build/test/resources/httest/config.htt

CLIENT
_AUTO_CLOSE on
_AUTO_COOKIE on

## Login
_REQ $container_host SSL:$container_https_port
__GET /moap3/jsf2app/ HTTP/1.1
__Host: localhost:9943
__Connection: keep-alive
__Cookie: AUTO
__
# check if OK and login fields are there
_EXPECT headers "200 OK"
_EXPECT body "Name:"
_EXPECT body "Password:"
_WAIT

## Post credentials
_REQ $container_host SSL:$container_https_port
__POST /moap3/jsf2app/j_security_check HTTP/1.1
__Host: localhost:9943
__Connection: keep-alive
__Cookie: AUTO
__Content-Type: application/x-www-form-urlencoded
__Content-Length: AUTO
__
__j_username=admin01&j_password=admin01&j_login=Login
# check if this did work by expecting 302 and the Location header
_EXPECT headers "302"
_MATCH headers "Location: https://localhost:9943(.*)" redirect_to
_WAIT

## Get page to inspect cache control headers
_REQ $container_host SSL:$container_https_port
__GET /moap3/jsf2app/browseBooks.xhtml HTTP/1.1
__Host: localhost:9943
__Connection: keep-alive
__Cookie: AUTO
__
# check if OK
_EXPECT headers "200 OK"
# check if headers for cache control are as we expect they should be
_EXPECT headers "Pragma: No-cache"
_EXPECT headers "Cache-Control: no-cache"
_EXPECT headers "Expires: Thu, 01 Jan 1970 01:00:00 CET"
_WAIT

END
